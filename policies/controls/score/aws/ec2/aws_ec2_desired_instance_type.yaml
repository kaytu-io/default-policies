ID: aws_ec2_desired_instance_type
Title: "EC2 Instances types are Approved"
Description: "Ensure all EC2 instances are of a given instance type Optimal and Aligned with our Organization"
Query:
    Engine: odysseus-v0.0.1
    ListOfTables:
        - aws_ec2_instance
    Parameters:
        - Key: awsAllowedInstanceTypes
          Required: false
    PrimaryTable: aws_ec2_instance
    QueryToExecute: "SELECT \n  instance_id as resource,\n  kaytu_resource_id,\n  kaytu_account_id,\n  CASE\n    WHEN '{{.awsAllowedInstanceTypes}}' = '' THEN 'ok'\n    WHEN '{{.awsAllowedInstanceTypes}}' LIKE '%' || instance_type || '%' THEN 'ok'\n    ELSE 'alarm'\n  END AS status,\n  CASE\n    WHEN '{{.awsAllowedInstanceTypes}}' = '' THEN 'allowed instance types not defined'\n    WHEN '{{.awsAllowedInstanceTypes}}' LIKE '%' || instance_type || '%' THEN instance_id || ' instance type is allowed by your organization' \n    ELSE instance_id || ' instance type is not allowed by your organization'\n  END AS reason,\n  region,\n  account_id\nFROM \n  aws_ec2_instance\n"
Severity: high
Tags:
    score_service_name:
        - AWS EC2
    score_tags:
        - Over Utilization
Connector:
    - AWS
