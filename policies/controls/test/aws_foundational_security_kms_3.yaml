ID: aws_foundational_security_kms_3
Title: 3 AWS KMS keys should not be unintentionally deleted
Description: This control checks whether AWS KMS customer managed keys (CMK) are scheduled
  for deletion. The control fails if a CMK is scheduled for deletion. CMKs cannot
  be recovered once deleted. Data encrypted under a KMS CMK is also permanently unrecoverable
  if the CMK is deleted. If meaningful data has been encrypted under a CMK scheduled
  for deletion,consider decrypting the data or re-encrypting the data under a new
  CMK unless you are intentionally performing a cryptographic erasure.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    select\n      arn as resource,\n      case\n        when key_state
    = 'PendingDeletion' then 'alarm'\n        else 'ok'\n      end as status,\n      case\n
    \       when key_state = 'PendingDeletion' then title || ' scheduled for deletion
    and will be deleted in ' || extract(day from deletion_date - current_timestamp)
    || ' day(s).'\n        else title || ' not scheduled for deletion.'\n      end
    as reason\n      \n      \n    from\n      aws_kms_key\n    where\n      key_manager
    = 'CUSTOMER';\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: critical
