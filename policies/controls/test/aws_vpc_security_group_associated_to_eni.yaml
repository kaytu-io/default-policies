ID: aws_vpc_security_group_associated_to_eni
Title: VPC security groups should be associated with at least one ENI
Description: This rule ensures the security groups are attached to an AWS Elastic
  Compute Cloud (AWS EC2) instance or to an ENI. This rule helps monitoring unused
  security groups in the inventory and the management of your environment.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with associated_sg as (\n      select\n        count(sg ->>
    'GroupId'),\n        sg ->> 'GroupId' as secgrp_id\n      from\n        aws_ec2_network_interface,\n
    \       jsonb_array_elements(groups) as sg\n        group by sg ->> 'GroupId'\n
    \   )\n    select\n      distinct s.arn as resource,\n      case\n        when
    a.secgrp_id = s.group_id then 'ok'\n        else 'alarm'\n      end as status,\n
    \     case\n        when a.secgrp_id = s.group_id then s.title || ' is associated
    with ' || a.count || ' ENI(s).'\n        else s.title || ' not associated to any
    ENI.'\n      end as reason\n      \n      \n    from\n      aws_vpc_security_group
    as s\n      left join associated_sg as a on s.group_id = a.secgrp_id;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
