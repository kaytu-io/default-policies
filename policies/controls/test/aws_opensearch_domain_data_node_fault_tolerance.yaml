ID: aws_opensearch_domain_data_node_fault_tolerance
Title: OpenSearch domains should have at least three data nodes
Description: This control checks whether OpenSearch domains are configured with at
  least three data nodes and zoneAwarenessEnabled is true. This control fails for
  an OpenSearch domain if instanceCount is less than 3 or zoneAwarenessEnabled is
  false.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    select\n      arn as resource,\n      case\n        when cluster_config
    ->> 'ZoneAwarenessEnabled' = 'true' and cluster_config ->> 'InstanceCount' > '2'
    then 'ok'\n        else 'alarm'\n      end as status,\n      case\n        when
    cluster_config ->> 'ZoneAwarenessEnabled' = 'true' and cluster_config ->> 'InstanceCount'
    > '2' then title || ' zone awareness is '\n        || case when cluster_config
    ->> 'ZoneAwarenessEnabled' = 'true' then 'enabled' else 'disabled' end || ' with
    ' || (cluster_config ->> 'InstanceCount') || ' data node(s) configued.'\n        else
    title || ' zone awareness is ' || case when cluster_config ->> 'ZoneAwarenessEnabled'
    = 'true' then 'enabled' else 'disabled' end || ' with ' || (cluster_config ->>
    'InstanceCount') || ' data node(s) configued.'\n      end as reason\n      \n
    \     \n    from\n      aws_opensearch_domain;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
