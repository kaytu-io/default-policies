ID: aws_foundational_security_iam_21
Title: 21 IAM customer managed policies that you create should not allow wildcard
  actions for services
Description: 'This control checks whether the IAM identity-based policies that you
  create have Allow statements that use the * wildcard to grant permissions for all
  actions on any service. The control fails if any policy statement includes ''Effect'':
  ''Allow'' with ''Action'': ''Service:*''.'
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with wildcard_action_policies as (\n      select\n        arn,\n
    \       count(*) as statements_num\n      from\n        aws_iam_policy,\n        jsonb_array_elements(policy_std
    -> 'Statement') as s,\n        jsonb_array_elements_text(s -> 'Resource') as resource,\n
    \       jsonb_array_elements_text(s -> 'Action') as action\n      where\n        not
    is_aws_managed\n        and s ->> 'Effect' = 'Allow'\n        and resource = '*'\n
    \       and (\n          action like '%:*'\n          or action = '*'\n        )\n
    \     group by\n        arn\n    )\n    select\n      p.arn as resource,\n      case\n
    \       when w.arn is null then 'ok'\n        else 'alarm'\n      end status,\n
    \     p.name || ' contains ' || coalesce(w.statements_num,0)  ||\n        ' statements
    that allow action \"*\" on at least 1 AWS service on resource \"*\".' as reason\n
    \     \n      \n    from\n      aws_iam_policy as p\n      left join wildcard_action_policies
    as w on p.arn = w.arn\n    where\n      not p.is_aws_managed;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: low
