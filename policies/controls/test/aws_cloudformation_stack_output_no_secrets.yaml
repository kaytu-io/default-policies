ID: aws_cloudformation_stack_output_no_secrets
Title: CloudFormation stacks outputs should not have any secrets
Description: Ensure CloudFormation stacks outputs do not contain secrets like user
  names, passwords, and tokens. It is recommended to remove secrets since outputs
  cannot be encrypted resulting in any entity with basic read-metadata-only and access
  to CloudFormation outputs having access to these secrets.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with stack_output as (\n      select\n        id,\n        jsonb_array_elements(outputs)
    -> 'OutputKey' as k,\n        jsonb_array_elements(outputs) -> 'OutputValue' as
    v,\n        region,\n        account_id,\n        tags,\n        _ctx,\n        outputs,\n
    \       title\n      from\n        aws_cloudformation_stack\n    ),\n    stack_with_secrets
    as (\n      select\n        distinct id\n      from\n        stack_output\n      where\n
    \       lower(k::text) like any (array ['%pass%', '%secret%','%token%','%key%'])\n
    \       or k::text ~ '(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]'
    or lower(v::text) like any (array ['%pass%', '%secret%','%token%','%key%']) or
    v::text ~ '(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]'\n
    \   )\n    select\n      c.id as resource,\n      case\n        when c.outputs
    is null then 'ok'\n        when s.id is null then 'ok'\n        else 'alarm'\n
    \     end as status,\n      case\n        when c.outputs is null then title ||
    ' has no outputs.'\n        when s.id is null then title || ' no secrets found
    in outputs.'\n        else title || ' has secrets in outputs.'\n      end as reason\n
    \     \n      \n    from\n      stack_output as c\n      left join stack_with_secrets
    as s on c.id = s.id\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
