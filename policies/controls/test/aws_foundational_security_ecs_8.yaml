ID: aws_foundational_security_ecs_8
Title: 8 Secrets should not be passed as container environment variables
Description: This control checks if the key value of any variables in the environment
  parameter of container definitions includes AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY,
  or ECS_ENGINE_AUTH_DATA. This control fails if a single environment variable in
  any container definition equals AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, or ECS_ENGINE_AUTH_DATA.
  This control does not cover environmental variables passed in from other locations
  such as Amazon S3.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with definitions_with_secret_environment_variable as (\n      select\n
    \       distinct task_definition_arn as arn\n      from\n        aws_ecs_task_definition,\n
    \       jsonb_array_elements(container_definitions) as c,\n        jsonb_array_elements(
    c -> 'Environment') as e,\n            jsonb_array_elements(\n        case jsonb_typeof(c
    -> 'Secrets')\n            when 'array' then (c -> 'Secrets')\n            else
    null end\n        ) as s\n      where\n        e ->> 'Name' like any (array ['AWS_ACCESS_KEY_ID',
    'AWS_SECRET_ACCESS_KEY','ECS_ENGINE_AUTH_DATA'])\n        or s ->> 'Name' like
    any (array ['AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY','ECS_ENGINE_AUTH_DATA'])\n
    \   )\n    select\n      d.task_definition_arn as resource,\n      case\n        when
    e.arn is null then 'ok'\n        else 'alarm'\n      end as status,\n      case\n
    \       when e.arn is null then d.title || ' container environment variables does
    not have secrets.'\n        else d.title || ' container environment variables
    have secrets.'\n      end as reason\n      \n      \n    from\n      aws_ecs_task_definition
    as d\n      left join definitions_with_secret_environment_variable as e on d.task_definition_arn
    = e.arn;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: high
