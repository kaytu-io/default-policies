ID: aws_cis_compute_service_v100_4_6
Title: 4.6 Ensure Lambda functions are not exposed to everyone
Description: A publicly accessible Amazon Lambda function is open to the public and
  can be reviewed by anyone. To protect against unauthorized users that are sending
  requests to invoke these functions they need to be changed so they are not exposed
  to the public
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with wildcard_action_policies as (\n      select\n        arn,\n
    \       count(*) as statements_num\n      from\n        aws_lambda_function,\n
    \       jsonb_array_elements(policy_std -> 'Statement') as s\n      where\n        s
    ->> 'Effect' = 'Allow'\n        and (\n          ( s -> 'Principal' -> 'AWS')
    = '[\"*\"]'\n          or s ->> 'Principal' = '*'\n        )\n      group by\n
    \       arn\n    )\n    select\n      f.arn as resource,\n      case\n        when
    p.arn is null then 'ok'\n        else 'alarm'\n      end as status,\n      case\n
    \       when p.arn is null then title || ' does not allow public access.'\n        else
    title || ' contains ' || coalesce(p.statements_num,0) ||\n        ' statements
    that allows public access.'\n      end as reason\n      \n      \n    from\n      aws_lambda_function
    as f\n      left join wildcard_action_policies as p on p.arn = f.arn;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
