ID: aws_s3_bucket_default_encryption_enabled_kms
Title: S3 bucket default encryption should be enabled with KMS
Description: To help protect data at rest, ensure encryption is enabled for your AWS
  Simple Storage Service (AWS S3) buckets.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with data as (\n      select\n        distinct name\n      from\n
    \       aws_s3_bucket,\n        jsonb_array_elements(server_side_encryption_configuration
    -> 'Rules') as rules\n      where\n        rules -> 'ApplyServerSideEncryptionByDefault'
    ->> 'KMSMasterKeyID' is not null\n      )\n    select\n      b.arn as resource,\n
    \     case\n        when d.name is not null then 'ok'\n        else 'alarm'\n
    \     end status,\n      case\n        when d.name is not null then b.name ||
    ' default encryption with KMS enabled.'\n        else b.name || ' default encryption
    with KMS disabled.'\n      end reason\n      \n      \n    from\n      aws_s3_bucket
    as b\n      left join data as d on b.name = d.name;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
