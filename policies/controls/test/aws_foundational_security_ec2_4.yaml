ID: aws_foundational_security_ec2_4
Title: 4 Stopped EC2 instances should be removed after a specified time period
Description: This control checks whether any EC2 instances have been stopped for more
  than the allowed number of days. An EC2 instance fails this check if it is stopped
  for longer than the maximum allowed time period, which by default is 30 days.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    select\n      arn as resource,\n      case\n        when instance_state
    not in ('stopped', 'stopping') then 'skip'\n        when state_transition_time
    <= (current_date - interval '30' day) then 'alarm'\n        else 'ok'\n      end
    as status,\n      case\n        when instance_state not in ('stopped', 'stopping')
    then title || ' is in ' || instance_state || ' state.'\n        else title ||
    ' stopped since ' || to_char(state_transition_time , 'DD-Mon-YYYY') || ' (' ||
    extract(day from current_timestamp - state_transition_time) || ' days).'\n      end
    as reason\n      \n      \n    from\n      aws_ec2_instance;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: medium
