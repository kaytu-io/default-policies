ID: aws_ec2_instance_user_data_no_secrets
Title: EC2 instances user data should not have secrets
Description: User data is a metadata field of an EC2 instance that allows custom code to run after the instance is launched. It contains code which is exposed to any entity which has the most basic access to EC2, even read-only configurations. It is recommended to not use secrets in user data.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: |
        select
          arn as resource,
          case
            when user_data like any (array ['%pass%', '%secret%','%token%','%key%'])
              or user_data ~ '(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]' then 'alarm'
            else 'ok'
          end as status,
          case
            when user_data like any (array ['%pass%', '%secret%','%token%','%key%'])
              or user_data ~ '(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]' then instance_id ||' potential secret found in user data.'
            else instance_id ||  ' no secrets found in user data.'
          end as reason
          
          
        from
          aws_ec2_instance;
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Connector:
- aws
Tags: {}
Severity: ""
