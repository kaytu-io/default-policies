ID: aws_iam_policy_unused
Title: IAM policy should be in use
Description: This control checks whether the IAM policy ARN is attached to an IAM user, or a group with one or more IAM users, or an IAM role with one or more trusted entity.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: |
        with in_use_policies as (
          select
            attached_policy_arns
          from
            aws_iam_user
          union
          select
            attached_policy_arns
          from
            aws_iam_group
          where
            jsonb_array_length(users) > 0
          union
          select
            attached_policy_arns
          from
            aws_iam_role
        )
        select
          arn as resource,
          case
            when arn in (select jsonb_array_elements_text(attached_policy_arns) from in_use_policies) then 'ok'
            else 'alarm'
          end as status,
          case
            when arn in (select jsonb_array_elements_text(attached_policy_arns) from in_use_policies) then title || ' in use.'
            else title || ' not in use.'
          end as reason
          
          
        from
          aws_iam_policy;
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
Connector:
- aws
Tags: {}
Severity: low
