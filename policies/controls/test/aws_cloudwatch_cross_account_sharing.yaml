ID: aws_cloudwatch_cross_account_sharing
Title: CloudWatch should not allow cross-account sharing
Description: Ensure that your AWS CloudWatch is configured to allow access only to
  friendly AWS accounts in order to prevent unauthorized users from sharing their
  CloudWatch events.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with iam_role_cross_account_sharing_count as (\n      select\n
    \       arn,\n        replace(replace(replace((a -> 'Principal' ->> 'AWS'), '[',''),
    ']', ''), '\"', '') as cross_account_details,\n        account_id\n      from\n
    \       aws_iam_role,\n        jsonb_array_elements(assume_role_policy_std ->
    'Statement') as a\n      where\n        name = 'CloudWatch-CrossAccountSharingRole'\n
    \   )\n    select\n      a.arn as resource,\n      case\n        when c.arn is
    null then 'ok'\n        else 'info'\n      end as status,\n      case\n        when
    c.arn is null then 'CloudWatch does not allow cross-account sharing.'\n        else
    'CloudWatch allow cross-account sharing with '|| cross_account_details || '.'\n
    \     end as reason\n      \n    from\n      aws_account as a\n      left join
    iam_role_cross_account_sharing_count as c on c.account_id = a.account_id;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
