ID: aws_vpc_security_group_restrict_ingress_common_ports_all
Title: VPC security groups should restrict ingress access on ports 20, 21, 22, 3306,
  3389, 4333 from 0.0.0.0/0
Description: Manage access to resources in the AWS Cloud by ensuring common ports
  are restricted on AWS Elastic Compute Cloud (AWS EC2) security groups.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with ingress_ssh_rules as (\n      select\n        group_id,\n
    \       count(*) as num_ssh_rules\n      from\n        aws_vpc_security_group_rule\n
    \     where\n        type = 'ingress'\n        and cidr_ipv4 = '0.0.0.0/0'\n        and
    (\n            ( ip_protocol = '-1'\n            and from_port is null\n            )\n
    \           or (\n                from_port >= 22\n                and to_port
    <= 22\n            )\n            or (\n                from_port >= 3389\n                and
    to_port <= 3389\n            )\n            or (\n                from_port >=
    21\n                and to_port <= 21\n            )\n            or (\n                from_port
    >= 20\n                and to_port <= 20\n            )\n            or (\n                from_port
    >= 3306\n                and to_port <= 3306\n            )\n            or (\n
    \               from_port >= 4333\n                and to_port <= 4333\n            )\n
    \       )\n      group by\n        group_id\n    )\n    select\n      arn as resource,\n
    \     case\n        when ingress_ssh_rules.group_id is null then 'ok'\n        else
    'alarm'\n      end as status,\n      case\n        when ingress_ssh_rules.group_id
    is null then sg.group_id || ' ingress restricted for ports 20, 21, 22, 3306, 3389,
    4333 from 0.0.0.0/0.'\n        else  sg.group_id || ' contains ' || ingress_ssh_rules.num_ssh_rules
    || ' ingress rule(s) allowing access on ports 20, 21, 22, 3306, 3389, 4333 from
    0.0.0.0/0.'\n      end as reason\n      \n      \n    from\n      aws_vpc_security_group
    as sg\n      left join ingress_ssh_rules on ingress_ssh_rules.group_id = sg.group_id;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
