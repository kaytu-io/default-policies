ID: aws_iam_policy_custom_no_permissive_role_assumption
Title: IAM custom policy should not have overly permissive STS role assumption
Description: Ensure that no custom IAM policies exist which allow permissive role
  assumption.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with bad_policies as (\n      select\n        arn,\n        count(*)
    as num\n      from\n        aws_iam_policy,\n        jsonb_array_elements(policy_std
    -> 'Statement') as s,\n        jsonb_array_elements_text(s -> 'Resource') as resource,\n
    \       jsonb_array_elements_text(s -> 'Action') as action\n      where\n        not
    is_aws_managed\n        and s ->> 'Effect' = 'Allow'\n        and resource = '*'\n
    \       and (\n          ( action = '*'\n            or action = 'sts:*'\n            or
    action = 'sts:AssumeRole'\n          )\n        )\n      group by\n        arn\n
    \   )\n    select\n      p.arn as resource,\n      case\n        when b.arn is
    not null then 'alarm'\n        else 'ok'\n      end as status,\n      p.name ||
    ' contains ' || coalesce(b.num, 0) ||\n          ' statements that allow overly
    permissive STS role assumption.' as reason\n      \n      \n    from\n      aws_iam_policy
    as p\n      left join bad_policies as b on p.arn = b.arn\n    where\n        not
    is_aws_managed;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
