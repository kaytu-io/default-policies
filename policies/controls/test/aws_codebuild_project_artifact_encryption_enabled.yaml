ID: aws_codebuild_project_artifact_encryption_enabled
Title: CodeBuild project artifact encryption should be enabled
Description: This control checks if a CodeBuild project has encryption enabled for all of its artifacts. The rule is non-compliant if 'encryptionDisabled' is set to 'true' for any primary or secondary (if present) artifact configurations.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: |
        with secondary_artifact as (
          select
            distinct arn
          from
            aws_codebuild_project,
            jsonb_array_elements(secondary_artifacts) as a
          where
            a -> 'EncryptionDisabled' = 'true'
        )
        select
          a.arn as resource,
          case
            when p.artifacts ->> 'EncryptionDisabled' = 'false'
            and (p.secondary_artifacts is null or a.arn is null) then 'ok'
            else 'alarm'
          end as status,
          case
            when p.artifacts ->> 'EncryptionDisabled' = 'false'
            and (p.secondary_artifacts is null or a.arn is null) then p.title || ' all artifacts encryption enabled.'
            else p.title || ' all artifacts encryption not enabled.'
          end as reason
          
          
        from
          aws_codebuild_project as p
          left join secondary_artifact as a on a.arn = p.arn;
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
Connector:
- aws
Tags: {}
Severity: low
