ID: azure_storage_account_uses_private_link
Title: "Ensure Private Endpoints are used to access Storage Accounts"
Description: "Use private endpoints for your Azure Storage accounts to allow clients and services to securely access data located over a network via an encrypted Private Link. To do this, the private endpoint uses an IP address from the VNet for each service. Network traffic between disparate services securely traverses encrypted over the VNet. This VNet can also link addressing space, extending your network and accessing resources on it. Similarly, it can be a tunnel through public networks to connect remote infrastructures together. This creates further security through segmenting network traffic and preventing outside sources from accessing it."
Query:
    Engine: odysseus-v0.0.1
    ListOfTables:
        - azure_storage_account
        - azure_subscription
    Parameters: []
    PrimaryTable: azure_storage_account
    QueryToExecute: "with storage_account_connection as (\n  select\n    distinct a.id\n  from\n    azure_storage_account as a,\n    jsonb_array_elements(private_endpoint_connections) as connection\n  where\n    connection -> 'properties' -> 'privateLinkServiceConnectionState' ->> 'status' = 'Approved'\n)\nselect\n  distinct a.id as resource,\n  a.kaytu_account_id as kaytu_account_id,\n  a.kaytu_resource_id as kaytu_resource_id,\n  case\n    when s.id is null then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when s.id is null then a.name || ' not uses private link.'\n    else a.name || ' uses private link.'\n  end as reason\n  \n  , a.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_storage_account as a\n  left join storage_account_connection as s on a.id = s.id,\n  azure_subscription as sub\nwhere\n  sub.subscription_id = a.subscription_id;\n"
Severity: high
Tags:
    category:
        - Compliance
    cis:
        - "true"
    cis_item_id:
        - "3.10"
    cis_level:
        - "1"
    cis_section_id:
        - "3"
    cis_type:
        - manual
    cis_version:
        - v1.5.0
    plugin:
        - azure
    service:
        - Azure/Storage
Connector:
    - Azure
