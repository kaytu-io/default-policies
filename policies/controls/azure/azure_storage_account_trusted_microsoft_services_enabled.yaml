ID: azure_storage_account_trusted_microsoft_services_enabled
Title: "Ensure 'Trusted Microsoft Services' is enabled for Storage Account access"
Description: "Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules. These services will then use strong authentication to access the storage account. If the Allow trusted Microsoft services exception is enabled, the following services: Azure Backup, Azure Site Recovery, Azure DevTest Labs, Azure Event Grid, Azure Event Hubs, Azure Networking, Azure Monitor and Azure SQL Data Warehouse (when registered in the subscription), are granted access to the storage account."
Query:
    Engine: odysseus-v0.0.1
    ListOfTables:
        - azure_storage_account
        - azure_subscription
    Parameters: []
    PrimaryTable: azure_storage_account
    QueryToExecute: "select\n  sa.id as resource,\n  sa.kaytu_account_id as kaytu_account_id,\n  sa.kaytu_resource_id as kaytu_resource_id,\n  case\n    when network_rule_bypass not like '%AzureServices%' then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when network_rule_bypass not like '%AzureServices%' then sa.name || ' trusted Microsoft services not enabled.'\n    else sa.name || ' trusted Microsoft services enabled.'\n  end as reason\n  \n  , sa.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_storage_account sa,\n  azure_subscription sub\nwhere\n  sub.subscription_id = sa.subscription_id;\n"
Severity: medium
Tags:
    category:
        - Compliance
    cis:
        - "true"
    cis_item_id:
        - "3.7"
    cis_level:
        - "2"
    cis_section_id:
        - "3"
    cis_type:
        - manual
    cis_version:
        - v1.3.0
    plugin:
        - azure
    service:
        - Azure/Storage
Connector:
    - Azure
