Title: "Steampipe Table: aws_guardduty_publishing_destination - Query AWS GuardDuty Publishing Destinations using SQL"
Description: "Allows users to query AWS GuardDuty Publishing Destinations to retrieve information about where GuardDuty findings are published."
Connectors:
    - AWS
Query:
    Engine: odysseus-v0.0.1
    QueryToExecute: |-
        select
          d.destination_id,
          d.destination_arn,
          d.destination_type,
          p ->> 'Sid' as sid,
          p ->> 'Action' as policy_action,
          p ->> 'Effect' as effect,
          p -> 'Principal' ->> 'Service' as principal_service
        from
          aws_guardduty_publishing_destination as d,
          aws_s3_bucket as s,
          jsonb_array_elements(s.policy -> 'Statement') as p
        where
          d.destination_type = 'S3'
        and
          s.arn = d.destination_arn;
