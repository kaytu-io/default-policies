connectors:
- AWS
query: |-
  select
    r.backup_vault_name as backup_vault_name,
    r.recovery_point_arn as recovery_point_arn,
    r.resource_type as resource_type,
  case
      when r.resource_type = 'EBS' then (
        select tags from aws_ebs_snapshot where arn = concat(
          (string_to_array(r.recovery_point_arn, '::'))[1],
          ':',
          r.account_id,
          ':',
          (string_to_array(r.recovery_point_arn, '::'))[2]
        )
      )
      when r.resource_type = 'EC2' then (
        select tags from aws_ec2_ami where image_id = (string_to_array(r.recovery_point_arn, '::image/'))[2]
      )
      when r.resource_type in ('S3', 'EFS') then r.tags
  end as tags,
    r.region,
    r.account_id
  from
    aws_backup_recovery_point as r;
  
Title: "Steampipe Table: aws_backup_recovery_point - Query AWS Backup Recovery Points using SQL"
Description: "Allows users to query AWS Backup Recovery Points to gather comprehensive information about each recovery point within an AWS Backup vault."
