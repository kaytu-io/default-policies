connectors:
- AWS
query: " with trail_details as (\n  select\n    name as trail_name,\n    arn,\n    is_multi_region_trail,\n    is_logging,\n    event_selectors,\n    e ->> 'ReadWriteType' as read_write_type,\n    account_id,\n    region\n  from\n    aws_cloudtrail_trail,\n    jsonb_array_elements(event_selectors) as e\n)\nselect\n  -- Required Columns\n  arn as resource,\n  case\n    when not trail_details.is_multi_region_trail then 'alarm'\n    when not trail_details.is_logging then 'alarm'\n    when read_write_type <> 'All' then 'alarm'\n    else 'ok'\n  end as status,\n  trail_details.trail_name ||\n    case when trail_details.is_multi_region_trail then ' is ' else ' is not ' end || 'multi-region,' ||\n    case when trail_details.is_logging then ' logging enabled' else ' logging disabled' end ||\n    ' for ' || read_write_type || ' events.'\n  as reason,\n  -- Additional Dimensions\n  region,\n  account_id\nfrom\n  trail_details"
title: Find all accounts missing CloudTrails
